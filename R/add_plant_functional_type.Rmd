---
title: "Add Plant Functional Type (PFT) labels"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Plant functional types (PFTs) of interest: coniferous forest, deciduous forest, woody shrub, grass/herb, and bare ground.

## Manually add PFTs to spectral library

```{r load_cleaned_spectra, message=FALSE}
# read cleaned spectral library file 
cleaned_spectra <- read_csv(here::here("analysis", "data", "derived_data", "cleaned_spectra.csv"))
```


```{r}
# list unique taxon labels, add an empty columns to fill with plant functional type (PFT) and common name labels.
# PFTs of interest: coniferous_forest, deciduous_forest, woody_shrub, grass_herb, and bare_ground.
taxon_pft_lookup <- data.frame(genusSpecies = unique(cleaned_spectra$genusSpecies),
                               commonName = NA,
                               pft = NA)

for(i in 1:nrow(taxon_pft_lookup)){
  # print row and current genusSpecies label
  print(i)
  genusSpecies <- taxon_pft_lookup$genusSpecies[i]
  print(genusSpecies)
  
  if(genusSpecies == "Abies amabilis"){
    taxon_pft_lookup$pft[i] = "coniferous_forest"
    taxon_pft_lookup$commonName[i] = "Pacific silver fir"} 
  
  else if(genusSpecies == "Abies balsamea"){
    taxon_pft_lookup$pft[i] = "coniferous_forest"
    taxon_pft_lookup$commonName[i] = "balsam fir"}
  
  else if(genusSpecies == "Abies lasiocarpa"){
    taxon_pft_lookup$pft[i] = "coniferous_forest"
    taxon_pft_lookup$commonName[i] = "subalpine fir"}
  
  else if(genusSpecies == "Acacia greggii"){
    taxon_pft_lookup$pft[i] = "woody_shrub"
    taxon_pft_lookup$commonName[i] = "catclaw acacia"}
  
  else if(genusSpecies == "Acer barbatum"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "Southern sugar maple"}
  
  else if(genusSpecies == "Acer circinatum"){
    taxon_pft_lookup$pft[i] = "NA " ??? 
    taxon_pft_lookup$commonName[i] = "vine maple"}
  
  else if(genusSpecies == "Acer negundo"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "boxelder"}
  
  else if(genusSpecies == "Acer pensylvanicum"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "striped maple"}
  
  else if(genusSpecies == "Acer rubrum"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "red maple"}
  
  else if(genusSpecies == "Acer saccharinum"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "silver maple"}
  
  else if(genusSpecies == "Acer saccharum"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "sugar maple"}
  
  else if(genusSpecies == "Ailanthus altissima"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "tree of heaven"}
  
  else if(genusSpecies == "Alnus rubra"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"  # deciduous broadleaf tree 
    taxon_pft_lookup$commonName[i] = "red alder"}
  
  else if(genusSpecies == "Aloysia wrightii"){
    taxon_pft_lookup$pft[i] = "woody_shrub"
    taxon_pft_lookup$commonName[i] = "Wright's beebrush"}
  
  else if(genusSpecies == "Amelanchier laevis"){
    taxon_pft_lookup$pft[i] = "???" ???
    taxon_pft_lookup$commonName[i] = "Allegheny serviceberry"}
  
  else if(genusSpecies == "Amyris elemifera"){
    taxon_pft_lookup$pft[i] = "???"     ???
    taxon_pft_lookup$commonName[i] = "sea torchwood"}
  
  else if(genusSpecies == "Artemisia tridentata"){
    taxon_pft_lookup$pft[i] = "woody_shrub"
    taxon_pft_lookup$commonName[i] = "big sagebrush"}
  
  else if(genusSpecies == "Atriplex canescens"){
    taxon_pft_lookup$pft[i] = "woody_shrub"
    taxon_pft_lookup$commonName[i] = "fourwing saltbush"}
  
  else if(genusSpecies == "Atriplex confertifolia"){
    taxon_pft_lookup$pft[i] = "woody_shrub"
    taxon_pft_lookup$commonName[i] = "shadscale saltbush"}
  
  else if(genusSpecies == "Betula alleghaniensis"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "yellow birch"}
  
  else if(genusSpecies == "Betula lenta"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "sweet birch"}
  
  else if(genusSpecies == "Betula neoalaskana"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "resin birch"}
  
  else if(genusSpecies == "Betula nigra"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "river birch"}
  
  else if(genusSpecies == "Betula papyrifera"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "paper birch"}
  
  else if(genusSpecies == "Betula sp."){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "birch"}
  
  else if(genusSpecies == "Bourreria sp."){
    taxon_pft_lookup$pft[i] = "???"   ???
    taxon_pft_lookup$commonName[i] = "strongbark"}
  
  else if(genusSpecies == "Bursera simaruba"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"  # "semi-deciduous"
    taxon_pft_lookup$commonName[i] = "gumbo limbo"}
  
  else if(genusSpecies == "Carpinus caroliniana"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "American hornbeam"}
  
  else if(genusSpecies == "Carya aquatica"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "water hickory"}
  
  else if(genusSpecies == "Carya cordiformis"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "bitternut hickory"}

  else if(genusSpecies == "Carya glabra"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "pignut hickory"}
  
  else if(genusSpecies == "Carya illinoinensis"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "pecan"}
  
  else if(genusSpecies == "Carya ovalis"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "red hickory"}
  
  else if(genusSpecies == "Carya ovata"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "shagbark hickory"}
  
  else if(genusSpecies == "Carya tomentosa"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "mockernut hickory"}
  
  else if(genusSpecies == "Celtis laevigata"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "sugarberry"}
  
  else if(genusSpecies == "Celtis occidentalis"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "common hackberry"}
  
  else if(genusSpecies == "Cercis canadensis"){
    taxon_pft_lookup$pft[i] = "???"   ???
    taxon_pft_lookup$commonName[i] = "eastern redbud"}
  
  else if(genusSpecies == "Chrysothamnus viscidiflorus"){
    taxon_pft_lookup$pft[i] = "woody_shrub"
    taxon_pft_lookup$commonName[i] = "yellow rabbitbrush"}
  
  else if(genusSpecies == "Cordia collococca"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "red manjack"}
  
  else if(genusSpecies == "Cornus drummondii"){
    taxon_pft_lookup$pft[i] = "???"    ???
    taxon_pft_lookup$commonName[i] = "roughleaf dogwood"}
  
  else if(genusSpecies == "Cornus florida"){
    taxon_pft_lookup$pft[i] = "???"    ???
    taxon_pft_lookup$commonName[i] = "flowering dogwood"}

  else if(genusSpecies == "Corylus cornuta"){
    taxon_pft_lookup$pft[i] = "woody_shrub"      # deciduous shrubby hazel
    taxon_pft_lookup$commonName[i] = "beaked hazelnut"}
  
  else if(genusSpecies == "Diospyros virginiana"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "common persimmon"}
  
  else if(genusSpecies == "Ephedra trifurca"){
    taxon_pft_lookup$pft[i] = "woody_shrub"
    taxon_pft_lookup$commonName[i] = "longleaf jointfir"}
  
  else if(genusSpecies == "Ericameria laricifolia"){
    taxon_pft_lookup$pft[i] = "woody_shrub"
    taxon_pft_lookup$commonName[i] = "turpentine bush"}
  
  else if(genusSpecies == "Exostema caribaeum"){
    taxon_pft_lookup$pft[i] = "woody_shrub"  # "evergreen shrub or small tree" 
    taxon_pft_lookup$commonName[i] = "Caribbean princewood"}
  
  else if(genusSpecies == "Fagus grandifolia"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "American beech"}
  
  else if(genusSpecies == "Frangula purshiana"){
    taxon_pft_lookup$pft[i] = "???"     ???
    taxon_pft_lookup$commonName[i] = "Cascara buckthorn"}
  
  else if(genusSpecies == "Fraxinus americana"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "white ash"}
  
  else if(genusSpecies == "Fraxinus nigra"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "black ash"}
  
  else if(genusSpecies == "Fraxinus pennsylvanica"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "green ash"}
  
  else if(genusSpecies == "Fraxinus sp."){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "ash"}

  else if(genusSpecies == "Gaultheria shallon"){
    taxon_pft_lookup$pft[i] = "woody_shrub"     # broadleaved evergreen shrub
    taxon_pft_lookup$commonName[i] = "salal"}
  
  else if(genusSpecies == "Gleditsia triacanthos"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "honey locust"}
  
  else if(genusSpecies == "Gutierrezia sarothrae"){
    taxon_pft_lookup$pft[i] = "woody_shrub"
    taxon_pft_lookup$commonName[i] = "broom snakeweed"}
  
  else if(genusSpecies == "Halesia sp."){
    taxon_pft_lookup$pft[i] = "deciduous_forest"  # small, deciduous, understory tree 
    taxon_pft_lookup$commonName[i] = "silverbell"}
  
  else if(genusSpecies == "Hamamelis virginiana"){
    taxon_pft_lookup$pft[i] = "woody_shrub"
    taxon_pft_lookup$commonName[i] = "American witchhazel"}
  
  else if(genusSpecies == "Ilex montana"){
    taxon_pft_lookup$pft[i] = "???"          ???
    taxon_pft_lookup$commonName[i] = "mountain holly"}
  
  else if(genusSpecies == "Ilex opaca"){
    taxon_pft_lookup$pft[i] = "woody_shrub"   ???      # broadleaved evergreen tree
    taxon_pft_lookup$commonName[i] = "American holly"}
  
  else if(genusSpecies == "Juglans nigra"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "black walnut"}
  
  else if(genusSpecies == "Juniperus osteosperma"){
    taxon_pft_lookup$pft[i] = "coniferous_forest"
    taxon_pft_lookup$commonName[i] = "Utah juniper"}

  else if(genusSpecies == "Juniperus virginiana"){
    taxon_pft_lookup$pft[i] = "coniferous_forest"
    taxon_pft_lookup$commonName[i] = "red cedar"}
  
  else if(genusSpecies == "Larix sp."){
    taxon_pft_lookup$pft[i] = "coniferous_forest"
    taxon_pft_lookup$commonName[i] = "larch"}
  
  else if(genusSpecies == "Larrea tridentata"){
    taxon_pft_lookup$pft[i] = "woody_shrub"
    taxon_pft_lookup$commonName[i] = "creosote bush"}
  
  else if(genusSpecies == "Liquidambar styraciflua"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "sweetgum"}
  
  else if(genusSpecies == "Liriodendron tulipifera"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "tuliptree"}
  
  else if(genusSpecies == "Lonicera maackii"){
    taxon_pft_lookup$pft[i] = "woody_shrub"
    taxon_pft_lookup$commonName[i] = "Amur honeysuckle"}
  
  else if(genusSpecies == "Maclura pomifera"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"   # small deciduous tree or large shrub
    taxon_pft_lookup$commonName[i] = "Osage-orange"}
  
  else if(genusSpecies == "Mahonia nervosa"){
    taxon_pft_lookup$pft[i] = "woody_shrub"      # evergreen shrub
    taxon_pft_lookup$commonName[i] = "Cascade barberry"}
  
  else if(genusSpecies == "Mangifera indica"){
    taxon_pft_lookup$pft[i] = "???"       ???   # broadleaf evergreen tree
    taxon_pft_lookup$commonName[i] = "mango"}
  
  else if(genusSpecies == "Melia azedarach"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "Chinaberrytree"}
  
  else if(genusSpecies == "Morus rubra"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "red mulberry"}
  
  else if(genusSpecies == "Nyssa aquatica"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "water tupelo"}
  
  else if(genusSpecies == "Nyssa biflora"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "swamp tupelo"}
  
  else if(genusSpecies == "Nyssa sylvatica"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "blackgum"}
  
  else if(genusSpecies == ""){
    taxon_pft_lookup$pft[i] = ""
    taxon_pft_lookup$commonName[i] = ""}
  
  else if(genusSpecies == ""){
    taxon_pft_lookup$pft[i] = ""
    taxon_pft_lookup$commonName[i] = ""}

  else if(genusSpecies == ""){
    taxon_pft_lookup$pft[i] = ""
    taxon_pft_lookup$commonName[i] = ""}
  
  else if(genusSpecies == ""){
    taxon_pft_lookup$pft[i] = ""
    taxon_pft_lookup$commonName[i] = ""}
  
  else if(genusSpecies == ""){
    taxon_pft_lookup$pft[i] = ""
    taxon_pft_lookup$commonName[i] = ""}
  
  else if(genusSpecies == ""){
    taxon_pft_lookup$pft[i] = ""
    taxon_pft_lookup$commonName[i] = ""}
  
  else if(genusSpecies == ""){
    taxon_pft_lookup$pft[i] = ""
    taxon_pft_lookup$commonName[i] = ""}
  
  else if(genusSpecies == ""){
    taxon_pft_lookup$pft[i] = ""
    taxon_pft_lookup$commonName[i] = ""}
  
  else if(genusSpecies == ""){
    taxon_pft_lookup$pft[i] = ""
    taxon_pft_lookup$commonName[i] = ""}

  else if(genusSpecies == ""){
    taxon_pft_lookup$pft[i] = ""
    taxon_pft_lookup$commonName[i] = ""}
  
  else if(genusSpecies == ""){
    taxon_pft_lookup$pft[i] = ""
    taxon_pft_lookup$commonName[i] = ""}
  
  else if(genusSpecies == ""){
    taxon_pft_lookup$pft[i] = ""
    taxon_pft_lookup$commonName[i] = ""}
  
  else if(genusSpecies == "Pseudotsuga menziesii"){
    taxon_pft_lookup$pft[i] = "coniferous_forest"
    taxon_pft_lookup$commonName[i] = "Douglas-fir"}
  
  else if(genusSpecies == "Vaccinium parvifolium"){ 
    taxon_pft_lookup$pft[i] = "woody_shrub"       # deciduous Shrub
    taxon_pft_lookup$commonName[i] = "red huckleberry"}
  
  else if(genusSpecies == "Populus tremuloides"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "quaking aspen"}
  
  else if(genusSpecies == "Tsuga canadensis"){
    taxon_pft_lookup$pft[i] = "coniferous_forest"
    taxon_pft_lookup$commonName[i] = "eastern hemlock"}
  
  else if(genusSpecies == "Picea sp."){
    taxon_pft_lookup$pft[i] = "coniferous_forest"
    taxon_pft_lookup$commonName[i] = "spruce"}
  
  else if(genusSpecies == "Rhamnus davurica"){
    taxon_pft_lookup$pft[i] = "???"              ???
    taxon_pft_lookup$commonName[i] = "Dahurian buckthorn"}
  
  else if(genusSpecies == "Lonicera maackii"){
    taxon_pft_lookup$pft[i] = "woody_shrub"
    taxon_pft_lookup$commonName[i] = "Amur honeysuckle"}
  
  else if(genusSpecies == "Prunus serotina"){
    taxon_pft_lookup$pft[i] = "???"       ???
    taxon_pft_lookup$commonName[i] = "black cherry"}
  
  else if(genusSpecies == "Quercus alba"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "white oak"}
  
  else if(genusSpecies == "Robinia pseudoacacia"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "black locust"}
  
  else if(genusSpecies == "Pinus strobus"){
    taxon_pft_lookup$pft[i] = "coniferous_forest"
    taxon_pft_lookup$commonName[i] = "eastern white pine"}
  
  else if(genusSpecies == "Tetradium daniellii"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "bee-bee tree"}
  
  else if(genusSpecies == "Picea mariana"){
    taxon_pft_lookup$pft[i] = "coniferous_forest"
    taxon_pft_lookup$commonName[i] = "black spruce"}
  
  else if(genusSpecies == "Picea glauca"){
    taxon_pft_lookup$pft[i] = "coniferous_forest"
    taxon_pft_lookup$commonName[i] = "white spruce"}
  
  else if(genusSpecies == "Ulmus crassifolia"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "cedar elm"}
  
  else if(genusSpecies == "Quercus stellata"){
    taxon_pft_lookup$pft[i] = "deciduous_forest"
    taxon_pft_lookup$commonName[i] = "post oak"}
  
  else if(genusSpecies == ""){
    taxon_pft_lookup$pft[i] = ""
    taxon_pft_lookup$commonName[i] = ""}
  
  else if(genusSpecies == ""){
    taxon_pft_lookup$pft[i] = ""
    taxon_pft_lookup$commonName[i] = ""}
  
  else print("PFT unknown")
  
  # print corresponding PFT
  print(taxon_pft_lookup$pft[i])
}

```

## R packages: attempting to automate PFT labeling

### USDA Plants Database

USDA Plants Database R API tutorial: https://recology.info/2016/10/usda-plants-database-r/ 

The USDA maintains a database of plant information, some of it trait data, some of it life history. Check it out at http://plants.usda.gov/java/

```{r install_load_packages, message=FALSE}
#install.packages("request")
#library(devtools)
#devtools::install_github("sckott/request")
library(request)
library(tibble)
library(tidyverse)
library(here)
```

```{r}
# Set the base url
root <- api("https://plantsdb.xyz")

root %>% api_path(heartbeat)
```

^^ My results here do not match those that show up on the tutorial page above. Maybe the API is down or the URL has changed? 

Based on the GitHub issue discussion (https://github.com/USDA/USDA-APIs/issues/7), someone uploaded USDA plants data here from 2016: https://uofi.app.box.com/v/usdaplants

```{r, eval=FALSE, include=FALSE}
# Specify URL where file is stored 
url <- "https://uofi.app.box.com/v/usdaplants/folder/6688524249/usda_plants_20160713.csv"
destFile <- file.path(here::here(), "analysis","data", "usda_plants_20160713.csv")
# Apply download.file function in R
download.file(url, destFile)
```

```{r, include = FALSE, eval=FALSE}
#usda_plants <- read_csv(file.path(here::here(), "analysis", "data", "usda_plants_20160713.csv"))

# Error in nchar(x) : invalid multibyte string, element 2
# ^ Issue with some of the column names in the .csv? 
```



### BIEN 

RBIEN tutorial: https://cmerow.github.io/RDataScience/3_3_RBIEN_tutorial.html

```{r install_load_packages_bien, message=FALSE, warning=FALSE}
library(BIEN)
library(ape) # Package for working with phylogenies in R
library(maps) # Useful for making quick maps of occurrences
library(sp) # A package for spatial data
```

BIEN traits and taxonomic data

"Let’s say we’re interested in the genus [Abies], and we’d like to get an idea of how many species there are in this genus and what higher taxa it falls within."

*Abies* genus is fir trees (coniferous trees). The "higher_plant_group" returned by the BIEN taxonomy function is "gymnosperms (conifers)"

```{r}
Abies_taxonomy<-BIEN_taxonomy_genus(genus = "Abies")

#View(Abies_taxonomy)
Abies_taxonomy[1:3,]
```

*Acer rubrum* species is the red maple (deciduous trees). The "higher_plant_group" returned by the BIEN taxonomy is "flowering plants".

```{r}
Acer_rubrum_taxonomy <- BIEN_taxonomy_species(species = "Acer rubrum")
Acer_rubrum_taxonomy[1:3,]
```

### TRY Database

https://www.try-db.org/TryWeb/Home.php

### Taxize

https://www.rdocumentation.org/packages/taxize/versions/0.9.99
